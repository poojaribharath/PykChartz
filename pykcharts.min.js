PykCharts={},PykCharts.BubblePack=function(a){this.execute=function(){var b=this;d3.json(a.data,function(a,c){b.data=c,b.render(),b.renderTooltip()})},this.render=function(){function b(a){function b(a,d){d.children?d.children.forEach(function(a){b(d.name,a)}):(console.log("className:"+d),console.log("ttip:"+d.ttip),console.log("color:"+d.colors),c.push({packageName:a,className:d.name,value:d.size,tip:d.ttip,color:d.colors}))}var c=[];return b(null,a),console.log("classes:"+c.ttip),{children:c}}{var c=this,d=600,e=d3.format(",d"),f=d3.scale.category20c(),g=d3.layout.pack().sort(null).size([d,d]).padding(1.5),h=d3.select(a.selection).append("svg").attr("width",d).attr("height",d).attr("class","bubble");d3.scale.linear().domain([0,1e4]).range([0,d])}d3.json(a.data,function(a,d){var i=h.selectAll(".node").data(g.nodes(b(d)).filter(function(a){return!a.children})).enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+a.x+","+a.y+")"});i.append("title").text(function(a){return a.className+": "+e(a.value)}),i.append("circle").attr("r",function(a){return a.r}).on("mouseover",function(a){return c.tooltip.html(a.tip).style("visibility","visible")}).on("mousemove",function(){return c.tooltip.style("top",event.pageY-10+"px").style("left",event.pageX+10+"px")}).on("mouseout",function(){return c.tooltip.style("visibility","hidden")}).style("fill",function(a){return f(a.packageName)}),i.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(a){return a.className.substring(0,a.r/3)})}),d3.select(self.frameElement).style("height",d+"px")},this.renderTooltip=function(){$("#pyk-bubble-tooltip").remove(),this.tooltip=d3.select("body").append("div").attr("id","pyk-bubble-tooltip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background","#fff").style("padding","10px 20px").style("box-shadow","0 0 10px #000").style("border-radius","5px").text("a simple tooltip")}},PykCharts.Chord=function(a){return this.execute=function(){if(!this.validate_options())return!1;var a=this;d3.json(a.options.relations,function(b,c){a.relations=c,d3.json(a.options.frequency,function(b,c){a.frequency=c,a.render()})})},this.validate_options=function(){return void 0==this.options.selection?!1:void 0==this.options.relations?!1:void 0==this.options.frequency?!1:!0},this.options=jQuery.extend({width:700,height:500},a),this.render=function(){this.nicks=this.frequency.map(function(a){return a.nick}),this.color=this.frequency.map(function(a){return a.color}),this.generateMatrix(),this.renderChord()},this.renderChord=function(){function a(a){return function(b,c){var d,e=new Array,g=[];0==a?($(".spinning").css("-webkit-animation-play-state","paused"),$(".spinning").css("animation-play-state","paused")):($(".spinning").css("-webkit-animation-play-state","running"),$(".spinning").css("animation-play-state","runnin")),f.selectAll("g.chord path").filter(function(a,b){return d=a.target.index,e[b]=a.source.index,a.source.index!=c&&a.target.index!=c}).transition().style("opacity",a),f.selectAll("g.chordname text").filter(function(a){return c==d||c==d-1||c==d-2||c==d-3||c==d-4||c==d-5||c==d-6||c==d-7||c==d-8||c==d-9?($.each(e,function(a,b){-1===$.inArray(b,g)&&g.push(b)}),a.index!=c&&a.index!=g[0]&&a.index!=g[1]&&a.index!=g[2]&&a.index!=g[3]&&a.index!=g[4]&&a.index!=g[5]&&a.index!=g[6]&&a.index!=g[7]&&a.index!=g[8]&&a.index!=g[9]):a.index!=c&&a.index!=d&&a.index!=d-1&&a.index!=d-2&&a.index!=d-3&&a.index!=d-4&&a.index!=d-5&&a.index!=d-6&&a.index!=d-7&&a.index!=d-8&&a.index!=d-9}).transition().style("opacity",a)}}var b=this,c=this.options.height,d=this.options.width;if(1==this.options.spinning)var e="pyk-chord spinning";else var e="pyk-chord";var f=d3.select(this.options.selection).append("svg").attr("class",e).attr("width",d).attr("height",c).append("g").attr("transform","translate("+d/2+","+c/2+")"),g=(d3.scale.ordinal().range([b.options.color]),.31*Math.min(d,c)),h=1.1*g,i=d3.layout.chord().padding(.05).sortSubgroups(d3.descending).matrix(b.matrix);f.append("g").attr("class","circumference").selectAll("path").data(i.groups).enter().append("path").style("fill",function(a){return b.color[a.index]}).style("stroke",function(a){return b.color[a.index]}).attr("d",d3.svg.arc().innerRadius(g).outerRadius(h)).on("mouseover",a(0)).on("mouseout",a(1)),f.append("g").attr("class","chord").selectAll("path").data(i.chords).enter().append("path").style("fill",function(a){return b.color[a.target.index]}).attr("d",d3.svg.chord().radius(g)).style("opacity",1);var j=f.append("svg:g").attr("class","chordname").selectAll("g").data(i.groups).enter().append("svg:g").attr("transform",function(a){return"rotate("+(180*a.startAngle/Math.PI-90)+")translate("+h+",0)"});j.append("svg:text").attr("x",8).attr("dy",".35em").attr("fill",function(a){return b.color[a.index]}).attr("text-anchor",function(a){return a.angle>Math.PI?"end":null}).attr("transform",function(a){return a.angle>Math.PI?"rotate(180)translate(-16)":null}).text(function(a){return b.nicks[a.index]})},this.generateMatrix=function(){function a(){for(var a=0;a<b.nicks.length;a++){c[a]=[];for(var d=0;d<b.nicks.length;d++)c[a][d]=0}}var b=this,c=[];a();for(i in this.relations){var d=this.relations[i];c[b.nicks.indexOf(d.from)][b.nicks.indexOf(d.to)]=d.messages}this.matrix=c},this},PykCharts.Choropleth=function(a){var b=[20,30,40,50,60,70,80,90],c=[20,30,40,50,60,70,80,90],d=["< 20","30+","40+","50+","60+","70+","80+","> 90"],e=d3.scale.threshold().domain(b).range(["#79C7FC","#6BBDF4","#5DB2EA","#53A4DB","#4A99CE","#4293C9","#3788BF","#2E82BA","#1F77B4"]),f=d3.scale.threshold().domain(b).range(["#79F779","#6FED6F","#64E564","#5CDB5C","#52CE52","#4AC44A","#3FB53F","#37AD37","#42A142"]);return this.execute=function(){if(!this.validate_options())return!1;$(this.options.selection).html("<img src='/pykcharts-images/spinner.gif'> Loading... Please wait");var a=this,b=this.options;d3.json(b.topojson,function(c,d){d3.json(b.state_data,function(c,e){d3.json(b.county_data,function(b,c){a.render(d,e,c)})})})},this.validate_options=function(){return void 0===this.options.selection?!1:void 0===this.options.topojson?!1:void 0===this.options.county_data?!1:void 0===this.options.state_data?!1:!0},this.options=jQuery.extend({width:960,height:400,scale:5,initScale:.6},a),this.render=function(a,b,c){$(this.options.selection).html("");var d=this.options.height,e=this.options.width;this.legends_group=d3.select(this.options.selection).append("svg").attr("class","pyk-choropleth-legend-holder").attr("height",30).attr("width",e),this.map_group=d3.select(this.options.selection).append("svg").attr("class","pyk-choropleth-map-holder").attr("height",d-100).attr("width",e),this.downlegend_group=d3.select(this.options.selection).append("svg").attr("class","pyk-choropleth-downlegends-holder").attr("height",50).attr("width",e),this.downlegend_group1=d3.select(this.options.selection).append("svg").attr("class","pyk-choropleth-downlegends-holder1").attr("height",50).attr("width",e);var f=Object.keys(b["0"]);this.param=f[0],this.renderTooltip(),this.draw(a,b,c),$("body").find(" .pyk-choropleth-downlegends-holder1").hide()},this.renderTooltip=function(){$("#choropleth-tooltip").remove(),this.tooltip=d3.select("body").append("div").attr("id","choropleth-tooltip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background","#fff").style("padding","10px 20px").style("box-shadow","0 0 10px #000").style("border-radius","5px").text("a simple tooltip")},this.draw=function(a,b,c){this.renderLegends(a,b,c),this.renderMaps(a,b,c,function(){})},this.renderLegends=function(a,b,c){var d=this,e=Object.keys(b["0"]),f=this.options.width/e.length,g=this.legends_group.selectAll("text").data(e);g.enter().append("text"),g.attr("y",15).attr("x",function(a,b){return b*f+25}).text(function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()}).on("click",function(e){d.param=e,"revenue"==e?($(" .pyk-choropleth-downlegends-holder1").hide(),$(" .pyk-choropleth-downlegends-holder").show()):($(" .pyk-choropleth-downlegends-holder1").css("display","block"),$(" .pyk-choropleth-downlegends-holder1").show(),$(" .pyk-choropleth-downlegends-holder").hide()),d.draw(a,b,c)});var h=this.legends_group.selectAll("circle").data(e);h.enter().append("circle"),h.attr("cy",10).attr("cx",function(a,b){return b*f+15}).attr("r",7).attr("style",function(a){var b=a===d.param?"#000":"#fff";return"stroke-width: 3px; stroke: #000; fill: "+b}).on("click",function(e){d.param=e,"revenue"==e?($(" .pyk-choropleth-downlegends-holder1").hide(),$(" .pyk-choropleth-downlegends-holder").show()):($(" .pyk-choropleth-downlegends-holder").hide(),$(" .pyk-choropleth-downlegends-holder1").show()),d.draw(a,b,c)})},this.renderMaps=function(a,b,g){var h=this,i=d3.geo.path(),j=this.options.initScale*this.options.scale,l=this.options.height,m=this.options.width,n=this.param,o=this.map_group;this.map_group.selectAll("g").remove();var p=o.append("g").attr("class","counties"),q=o.append("g").attr("class","states"),r=this.downlegend_group1.selectAll("g.legend").data(c).enter().append("g").attr("class","legend"),s=60,t=7;r.append("rect").attr("x",function(a,b){return s*b}).attr("y",20).attr("width",s).attr("height",t).style("fill",function(a){return f(a)}).style("opacity",.8),r.append("text").attr("x",function(a,b){return s*b}).attr("y",40).attr("class","mono").text(function(a,b){return d[b]}),p.selectAll("path").data(topojson.feature(a,a.objects.counties).features).enter().append("path").attr("class","county").attr("d",i).attr("style",function(a){if(g[a.id]){var b=g[a.id][n].color,c=1;return g[a.id][n].data&&(c=g[a.id][n].data/100),"fill: "+b+"; opacity: "+c}}).attr("data-id",function(a){return a.id}).attr("transform",function(){return"scale("+h.options.initScale+")"}).on("click",function(){var a,b,c;a=m/2,b=l/2,c=1,q.transition().ease("back").duration(1200).attr("transform","translate("+m/2+","+l/2+")scale("+c+")translate("+-a+","+-b+")"),p.transition().ease("back").duration(1200).attr("transform","translate("+m/2+","+l/2+")scale("+c+")translate("+-a+","+-b+")"),$("g.counties").fadeOut(),$("g.states path").css("fill",function(){return $(this).attr("data-color")}),$("g.states path").css("opacity",function(){return $(this).attr("data-heat")})}).on("mouseover",function(a){if(g[a.id]){var b=g[a.id][n].tooltip;h.tooltip.html(b),h.tooltip.style("visibility","visible")}}).on("mousemove",function(){var a=parseInt(h.tooltip.style("height"))+40,b=parseInt(h.tooltip.style("width"))/2;h.tooltip.style("top",event.pageY-a+"px").style("left",event.pageX-b+"px")}).on("mouseout",function(){h.tooltip.style("visibility","hidden")}),q.selectAll("path").data(topojson.feature(a,a.objects.states).features).enter().append("path").attr("class","state").attr("d",i).attr("data-heat",function(a){return b[a.id]?b[a.id][n].data?b[a.id][n].data/100:1:1}).attr("data-color",function(a){return b[a.id]?b[a.id][n].color:"black"}).attr("data-id",function(a){return a.id}).attr("transform",function(){return"scale("+h.options.initScale+")"}).attr("style",function(a){if(b[a.id]){var c=b[a.id][n].color,d=1;return b[a.id][n].data&&(d=b[a.id][n].data/100),"fill: "+c+"; opacity: "+d}}).on("click",function(a){var b=i.centroid(a),c=b[0]*h.options.initScale,d=b[1]*h.options.initScale;k=j,p.transition().delay(250).ease("elastic").duration(1200).attr("transform","translate("+m/2+","+l/2+")scale("+k+")translate("+-c+","+-d+")"),q.transition().delay(250).ease("elastic").duration(1200).attr("transform","translate("+m/2+","+l/2+")scale("+k+")translate("+-c+","+-d+")"),$("g.states path").css("fill","#fff"),$(this).css("fill","none"),$("g.states path").animate({opacity:.9}),$("g.counties").show()}).on("mouseover",function(a){if(g[a.id]){var c=b[a.id][n].tooltip;h.tooltip.html(c),h.tooltip.style("visibility","visible")}}).on("mousemove",function(){var a=parseInt(h.tooltip.style("height"))+40,b=parseInt(h.tooltip.style("width"))/2;h.tooltip.style("top",event.pageY-a+"px").style("left",event.pageX-b+"px")}).on("mouseout",function(){h.tooltip.style("visibility","hidden")});var u=this.downlegend_group.selectAll("g.legend").data(c).enter().append("g").attr("class","legend"),s=60,t=7;u.append("rect").attr("x",function(a,b){return s*b}).attr("y",20).attr("width",s).attr("height",t).style("fill",function(a){return e(a)}).style("opacity",.8),u.append("text").attr("x",function(a,b){return s*b}).attr("y",40).attr("class","mono").text(function(a,b){return d[b]}),$("g.counties").hide()},this},PykCharts.compare_with_circles=function(a){function b(a,b,c){return a.length>b&&(a=a.substring(0,b+1),a=a.substring(0,Math.min(a.length,a.lastIndexOf(" "))),a+=c),a}var c={top:20,right:200,bottom:0,left:20},d=a.width,e=a.height,f=2007,g=2013,h=d3.scale.category20c(),i=d3.scale.linear().range([0,d]),j=d3.svg.axis().scale(i).ticks(5).orient("top"),k=d3.format("0000");j.tickFormat(k);var l=d3.select(a.selection).append("svg").attr("class","pyk-compare_with_circles").attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom).style("margin-left",c.left+"px").append("g").attr("transform","translate("+c.left+","+c.top+")");d3.json(a.data,function(a){function c(){var a=d3.select(this).node().parentNode;d3.select(a).selectAll("circle").style("display","none"),d3.select(a).selectAll("text.value").style("display","block")}function e(){var a=d3.select(this).node().parentNode;d3.select(a).selectAll("circle").style("display","block"),d3.select(a).selectAll("text.value").style("display","none")}i.domain([f,g]);var k=d3.scale.linear().domain([f,g]).range([0,d]);l.append("g").attr("class","x axis").attr("transform","translate(0,0)").call(j);for(var m=0;m<a.length;m++){var n=l.append("g").attr("class","first row"),o=n.selectAll("circle").data(a[m].test).enter().append("circle"),p=n.selectAll("text").data(a[m].test).enter().append("text"),q=d3.scale.linear().domain([0,d3.max(a[m].test,function(a){return a[1]})]).range([2,12]);o.attr("cx",function(a){return k(a[0])}).attr("cy",30*m+30).attr("r",function(a){return q(a[1])}).style("fill",function(){return h(m)}),p.attr("y",30*m+35).attr("x",function(a){return k(a[0])-5}).attr("class","value").text(function(a){return a[1]}).style("fill",function(){return h(m)}).style("display","none"),n.append("text").attr("y",30*m+35).attr("x",d+20).attr("class","label").text(b(a[m].name,30,"...")).style("fill",function(){return h(m)}).on("mouseover",c).on("mouseout",e)}})},PykCharts.GoogleHeat=function(a){return this.execute=function(){if(!this.validate_options())return!1;this.container=$(this.options.selection),this.div=$("<div>").css("height",this.options.height+"px").css("width",this.options.width+"px"),this.container.append(this.div);var a=this;$.getJSON(this.options.data,function(b){a.data=b,a.render()})},this.validate_options=function(){return void 0==this.options.selection?!1:void 0==this.options.data?!1:!0},this.options=jQuery.extend({width:960,height:500,center:new google.maps.LatLng(-25.363882,131.044922),defaultZoom:3,tooltipZoom:4},a),this.render=function(){var a=this.div.get(0),b={center:this.options.center,zoom:this.options.defaultZoom,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(a,b),this.map.setOptions({styles:this.setupStyle()}),this.setupHeat(),this.setupMarkers()},this.setupStyle=function(){return[{stylers:[{hue:"#FFBB78"},{visibility:"simplified"},{gamma:.5},{weight:.5}]},{elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"water",stylers:[{color:"#1F77B4"}]}]},this.setupHeat=function(){var a=new google.maps.MVCArray(this.heatData()),b=new google.maps.visualization.HeatmapLayer({data:a});b.setMap(this.map)},this.setupMarkers=function(){var a=this,b=new MarkerManager(a.map),c=[];for(i in this.data){var d=this.data[i],e=new google.maps.Marker({position:new google.maps.LatLng(d.latitude,d.longitude),title:d.tooltip,icon:d.marker});c.push(e);var f=new google.maps.InfoWindow({content:d.tooltip});google.maps.event.addListener(e,"click",function(b){return function(){b.open(a.map,this)}}(f))}google.maps.event.addListener(b,"loaded",function(){b.addMarkers(c,a.options.tooltipZoom),b.refresh()})},this.heatData=function(){var a=[];for(i in this.data){var b=this.data[i],c=new google.maps.LatLng(b.latitude,b.longitude);a.push({location:c,weight:b.count})}return a},this},PykCharts.River=function(a){return this.execute=function(){if(!this.validate_options())return!1;$(this.options.selection).html("<img src='/pykcharts-images/spinner.gif'> Loading... Please wait");var a=this,b=this.options;d3.json(b.data,function(b,c){a.data=c,a.render()})},this.validate_options=function(){return void 0==this.options.selection?!1:void 0==this.options.data?!1:this.options.width<300?!1:!0},this.options=jQuery.extend({width:960,height:200,filterList:[],fullList:[],extended:!1},a),this.render=function(){$(this.options.selection).html("");var a=this.options.height,b=this.options.width;this.svg=d3.select(this.options.selection).append("svg").attr("class","pyk-river").attr("height",a).attr("width",b),this.legends_group=this.svg.append("g").attr("class","legend-holder").attr("transform","translate(0,15)"),this.map_group=this.svg.append("g").attr("class","map-holder"),this.renderTooltip(),this.draw()},this.renderTooltip=function(){$("#river-tooltip").remove(),this.tooltip=d3.select("body").append("div").attr("id","river-tooltip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background","#fff").style("padding","10px 20px").style("box-shadow","0 0 10px #000").style("border-radius","5px").text("a simple tooltip")},this.draw=function(){this.renderLegends(),this.renderChart()},this.renderLegends=function(){var a=this,b=(this.legends_group.append("g").attr("class","option-holder").attr("transform","translate(0,15)"),[{name:"Percentage",on:this.extended},{name:"Absolute",on:!this.extended}]),c=this.legends_group.select("g.option-holder").selectAll("text").data(b);c.enter().append("text").text(function(a){return a.name}).attr("transform",function(a,b){return"translate("+(100*b+20)+",0)"}).on("click",function(){a.extended=!a.extended,a.draw()});var d=this.legends_group.select("g.option-holder").selectAll("circles").data(b);d.enter().append("circle").attr("cx",function(a,b){return 100*b+10}).attr("cy",-6).attr("r",6).attr("style",function(a){var b=a.on?"#000":"#fff";return"fill: "+b+"; stroke-width: 3px; stroke:#000"}).on("click",function(){a.extended=!a.extended,a.draw()});var e=this.data[0].breakup,f=(this.options.width-250)/e.length,g=this.legends_group.append("g").attr("class","legend-holder").attr("transform","translate(250,15)");g.selectAll("g.legend").data(e).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=b*f;return"translate("+c+",0)"}).on("click",function(b){a.toggleFilter(b.name)});var h=d3.selectAll("g.legend")[0];for(i in e){var j=d3.select(h[i]);j.selectAll("text").data([e[i]]).enter().append("text").text(function(b){return a.options.filterList.push(b.name),a.options.fullList.push(b.name),b.name}).attr("transform","translate(20,-1)");var k=j.selectAll("circle").data([e[i]]);k.enter().append("circle"),k.attr("cx",9).attr("cy",-6).attr("r",6).attr("style",function(b){var c=-1===a.options.filterList.indexOf(b.name)?"#fff":b.color;return 0===a.options.filterList.length&&(c=b.color),"fill: "+c+"; stroke-width: 3px; stroke:"+b.color})}},this.renderChart=function(){var a=jQuery.extend(!0,[],this.data),b=40,c=this;a=this.filter(a),a=this.parseData(a);var d=this.maxTotal(a),e=this.options.width,f=this.options.height,g=d3.scale.linear().domain([0,d]).range([0,e-200]),h=d3.scale.linear().domain([0,f]).range([b,f]),j=f/(2*a.length),k=2*j,l=this.map_group;l.selectAll("line.top_line").data(a).enter().append("line").attr("class","top_line").attr("x1",0).attr("x2",e).attr("y1",function(a,b){return h(b*k)}).attr("y2",function(a,b){return h(b*k)}),l.selectAll("line.bottom_line").data(a).enter().append("line").attr("class","bottom_line").attr("x1",0).attr("x2",e).attr("y1",function(a,b){return h(b*k+j)}).attr("y2",function(a,b){return h(b*k+j)});var m=l.selectAll("g.bar-holder").data(a);m.enter().append("g").attr("class","bar-holder").attr("transform",function(a,b){var c=h(b*k),e=g((d-a.breakupTotal)/2)+100;return"translate("+e+","+c+")"}),m.transition().duration(1e3).attr("height",h(j)).attr("width",function(a){return g(a.breakupTotal)}).attr("transform",function(a,b){var f=h(b*k),i=g((d-a.breakupTotal)/2)+100,j=1,l=1;if(c.extended){var m=g(a.breakupTotal);j=(e-200)/m,l=2,i=h(100)}return"translate("+i+","+f+") scale("+j+", "+l+")"}),m.exit().remove();var n=l.selectAll("g.bar-holder")[0];for(i in a){var o=n[i],p=a[i].breakup,q=d3.select(o).selectAll("rect").data(p);q.enter().append("rect").attr("width",0),q.transition().duration(1e3).attr("x",function(a,b){if(0==b)return 0;for(var c=0,d=0;b>d;d++)c+=p[d].count;return g(c)}).attr("y",0).attr("height",function(){return j*(f-b)/f}).attr("width",function(a){return g(a.count)}),q.attr("style",function(a){return"fill: "+a.color}).on("mouseover",function(a){var b=d3.select("#river-tooltip");b.html(a.tooltip),b.style("visibility","visible")}).on("mousemove",function(){var a=d3.select("#river-tooltip"),b=parseInt(a.style("height"))+40,c=parseInt(a.style("width"))/2;a.style("top",event.pageY-b+"px").style("left",event.pageX-c+"px")}).on("mouseout",function(){var a=d3.select("#river-tooltip");a.style("visibility","hidden")}).on("click",function(a){c.onlyFilter(a.name)}),q.exit().transition().duration(1e3).attr("width",0).remove()}var r=l.selectAll("text.cool_label").data(a);r.enter().append("text").attr("class","cool_label"),r.attr("x",e).attr("y",function(a,b){return h(b*k+j/2+5)}).text(function(a){return a.breakupTotal+" "+a.technical_name});var s=l.selectAll("text.left_label").data(a);s.enter().append("svg:text").attr("class","left_label"),s.attr("y",function(a,b){return h(b*k+j/2+5)}).attr("x",0).text(function(a){return a.display_name});var t=l.selectAll("text.right_label").data(a);if(t.enter().append("svg:text").attr("class","right_label"),t.attr("y",function(a,b){return h(b*k+1.5*j+5)}).attr("x",e).text(function(b,c){return void 0==a[c+1]?"":b.duration}),this.extended)return $("line.left_line").fadeOut(),$("line.right_line").fadeOut(),void 0;var u=l.selectAll("line.left_line").data(a);u.enter().append("line").attr("class","left_line").attr("y2",function(a,b){return h(b*k+j)}).attr("x2",function(a){return g((d-a.breakupTotal)/2)+100}),u.transition().duration(1e3).attr("style",function(b,c){return a[c+1]?void 0:"stroke-width: 0"}).attr("y1",function(a,b){return h(b*k+j)}).attr("x1",function(a){return g((d-a.breakupTotal)/2)+100}).attr("y2",function(a,b){return h((b+1)*k)}).attr("x2",function(b,c){return a[c+1]?g((d-a[c+1].breakupTotal)/2)+100:0});var v=l.selectAll("line.right_line").data(a);v.enter().append("line").attr("class","right_line").attr("y2",function(a,b){return h(b*k+j)}).attr("x2",function(a){return g((d-a.breakupTotal)/2+a.breakupTotal)+100}),v.transition().duration(1e3).attr("style",function(b,c){return a[c+1]?void 0:"stroke-width: 0"}).attr("y1",function(a,b){return h(b*k+j)}).attr("x1",function(a){return g((d-a.breakupTotal)/2+a.breakupTotal)+100}).attr("y2",function(a,b){return h((b+1)*k)}).attr("x2",function(b,c){return a[c+1]?g((d-a[c+1].breakupTotal)/2+a[c+1].breakupTotal)+100:0})},this.filter=function(a){this.options.filterList.length<1&&(this.options.filterList=jQuery.extend(!0,[],this.options.fullList));for(i in a){var b=a[i].breakup,c=[];for(j in b)jQuery.inArray(b[j].name,this.options.filterList)>=0&&c.push(b[j]);a[i].breakup=c}return a},this.onlyFilter=function(a){var b=this.options.filterList.indexOf(a);1===this.options.filterList.length&&-1!=b?this.options.filterList=[]:(this.options.filterList=[],this.options.filterList.push(a)),this.draw()},this.toggleFilter=function(a){var b=this.options.filterList.indexOf(a);-1===b?this.options.filterList.push(a):this.options.filterList.splice(b,1),this.draw()},this.totalInBreakup=function(a){var b=0;for(i in a)b+=a[i].count;return b},this.maxTotal=function(a){var b=[];for(i in a)b.push(a[i].breakupTotal);return b=b.sort(function(a,b){return a-b}),b[b.length-1]},this.parseData=function(a){for(i in a)a[i].breakupTotal=this.totalInBreakup(a[i].breakup);return a},this},PykCharts.treerect=function(a){this.execute=function(){var b=this;width=this.options.width,height=this.options.height,d3.json(a.data,function(a,c){b.data=c,b.render(),b.renderTooltip()})},this.options=jQuery.extend({width:550,height:400},a),this.render=function(){var b,c,d=this,e=width-60,f=height-135,g=(d3.scale.linear().range([0,e]),d3.scale.linear().range([0,f]),d3.layout.treemap().round(!1).size([e,f]).sticky(!0).value(function(a){return a.size})),h=d3.select(a.selection).append("div").attr("class","chart").style("width",e+"px").style("height",f+"px").append("svg:svg").attr("width",e).attr("height",f).append("svg:g").attr("transform","translate(.5,.5)");d3.json(a.data,function(a){c=b=a;var e=g.nodes(b).filter(function(a){return!a.children}),f=h.selectAll("g").data(e).enter().append("svg:g").attr("class","cell").attr("transform",function(a){return"translate("+a.x+","+a.y+")"});f.append("svg:rect").attr("width",function(a){return a.dx-1}).attr("height",function(a){return a.dy-1}).on("mouseover",function(a){return d.tooltip.html(a.ttip).style("visibility","visible")}).on("mousemove",function(){return d.tooltip.style("top",event.pageY-10+"px").style("left",event.pageX+10+"px")}).on("mouseout",function(){return d.tooltip.style("visibility","hidden")}).style("fill",function(a){return a.colors}),f.append("image").attr("xlink:href",function(a){return a.img}).attr("x",10).attr("y",7).attr("width",17.92).attr("height",16),f.append("svg:text").attr("x",function(a){return a.dx/2}).attr("y",function(a){return a.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(a){return a.name}).attr("fill","white").style("opacity",function(a){return a.w=this.getComputedTextLength(),a.dx>a.w?1:0})})},this.renderTooltip=function(){$("#pyk-tree-tooltip").remove(),this.tooltip=d3.select("body").append("div").attr("id","pyk-tree-tooltip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background","#fff").style("padding","10px 20px").style("box-shadow","0 0 10px #000").style("border-radius","5px").text("a simple tooltip")}},PykCharts.Ultimate=function(a){return this.execute=function(){if(!this.validate_options())return!1;$(this.options.selection).html("<img src='/pykcharts-images/spinner.gif'> Loading... Please wait");var a=this;d3.json(this.options.data,function(b,c){a.data=c,a.render()})},this.validate_options=function(){return void 0==this.options.selection?!1:void 0==this.options.data?!1:this.options.width<300?!1:!0},this.options=jQuery.extend({width:960,height:400,filterList:[],fullList:[],extended:!1,margins:{left:40,right:20,top:10,bottom:80}},a),this.render=function(){$(this.options.selection).html("");var a=this.options.height,b=this.options.width;this.svg=d3.select(this.options.selection).append("svg").attr("class","pyk-ultimate").attr("height",a).attr("width",b),this.svg.append("g").attr("class","yaxis"),this.svg.append("g").attr("class","xaxis"),this.legends_group=this.svg.append("g").attr("class","legend-holder").attr("background","Red").attr("transform","translate(0,15)"),this.chart_group=this.svg.append("g").attr("class","chart-holder").attr("width",b-(this.options.margins.right+this.options.margins.left)).attr("height",a-(this.options.margins.top+this.options.margins.bottom)).attr("transform","translate("+this.options.margins.left+","+this.options.margins.top+")");var c=this.flattenData();this.the_bars=c[0],this.the_keys=c[1],this.the_layers=this.layers(this.the_bars),this.renderTooltip(),this.draw()},this.renderLegends=function(){function a(){var a=[];for(i in b.the_layers)if(b.the_layers[i].name){var c=b.the_layers[i].name,d=b.the_layers[i].values[0].color;a.push({name:c,color:d})}return a}var b=this,c=this.options.width,d=a(),e=this.legends_group.selectAll("g.legend_group").data(d).enter().append("g").attr("class","legend_group").attr("transform",function(a,b){return"translate("+(c-100*b-100)+", 0)"});for(i in d)var f=d3.select(e[0][i]),g=d[i],h=f.append("text").text(function(){return g.name}).attr("x",function(a,b){return 40*b}).attr("dy",-3),j=f.append("circle").attr("cx",function(a,b){return 100*b-10}).attr("cy",-6).attr("r",6).attr("style",function(a){return"fill: "+a.color+"; stroke-width: 3px; stroke:"+a.color})},this.getGroups=function(){var a={};for(i in this.the_bars){var b=this.the_bars[i];b.id&&(a[b.group]?a[b.group].push(b.id):a[b.group]=[b.id])}return a},this.renderChart=function(){var a=this,b=this.chart_group.attr("width"),c=this.chart_group.attr("height"),d=this.the_bars,e=this.the_keys,f=this.the_layers,g=this.getGroups(),h=(d3.layout.stack().values(function(a){return a.values})(f),[]);f.map(function(a,b){for(b in a.values){var c=a.values[b];h.push(c.y+c.y0)}});var j=d3.scale.ordinal().domain(d.map(function(a,b){return a.id||b})).rangeBands([0,b],.2),k=d3.scale.linear().domain([0,d3.max(h)]).range([a.options.margins.top,c]).nice(),l=d3.scale.linear().domain([d3.max(h),0]).range([a.options.margins.top,c]).nice(),m=(d3.scale.category10(),d3.svg.axis().scale(l).tickSize(-b,0,0).orient("left")),n=d3.svg.axis().scale(j).tickSize(-c,0,0).tickFormat(function(a){return e[a]?e[a]:void 0}).orient("bottom");this.svg.select("g.yaxis").transition(1e3).attr("transform","translate("+this.options.margins.left+", "+this.options.margins.top+")").call(m);var o=parseInt(this.options.margins.top)+parseInt(c);this.svg.select("g.xaxis").transition(1e3).attr("transform","translate("+this.options.margins.left+", "+o+")").call(n).selectAll("text").style("text-anchor","start").attr("dy","2px").attr("dx","20px").attr("transform",function(){return"rotate(90)"});var p=[];for(i in g){var q=g[i],r=j(q[0]),s=j.rangeBand()*q.length,r=r+s/2;p.push({x:r,name:i})}this.svg.selectAll("text.group_label").data(p).enter().append("text").attr("class","group_label").attr("x",function(b){return b.x+a.options.margins.left}).attr("y",function(){return parseInt(c)+24}).attr("text-anchor","middle").text(function(a){return a.name});var t=this.chart_group.selectAll("g.bars").data(f).enter().append("g").attr("class","bars"),u=t.selectAll("rect").data(function(a){return a.values}).enter().append("svg:rect").attr("height",0).attr("y",c).on("mouseover",function(a){var b=d3.select("#pyk-ultimate-tooltip");b.html(a.tooltip),b.style("visibility","visible")}).attr("fill",function(a){return a.color}).on("mousemove",function(){var a=d3.select("#pyk-ultimate-tooltip"),b=parseInt(a.style("height"))+40,c=parseInt(a.style("width"))/2;a.style("top",event.pageY-b+"px").style("left",event.pageX-c+"px")}).on("mouseout",function(){var a=d3.select("#pyk-ultimate-tooltip");a.style("visibility","hidden")});u.transition().duration(1e3).attr("x",function(a){return j(a.x)}).attr("width",function(){return j.rangeBand()}).attr("height",function(a){return k(a.y)}).attr("y",function(a){return c-k(a.y0+a.y)})},this.draw=function(){this.renderLegends(),this.renderChart()},this.renderTooltip=function(){$("#pyk-ultimate-tooltip").remove(),this.tooltip=d3.select("body").append("div").attr("id","pyk-ultimate-tooltip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background","#fff").style("padding","10px 20px").style("box-shadow","0 0 10px #000").style("border-radius","5px").text("a simple tooltip")},this.layers=function(a){function b(a){for(i in d){var b=d[i];if(b.name==a)return b}return c(a)}function c(a){var b={name:a,values:[]};return d.push(b),b}var d=[];for(i in a){var e=a[i];if(e.id){var f=e.id;for(k in e)if("id"!==k){var g=e[k];for(j in g){var h=g[j];if(h.name){var l=b(h.name);l.values.push({x:f,y:h.val,color:h.color,tooltip:h.tooltip})}}}}}return d},this.flattenData=function(){var a=[-1],b={};
for(i in this.data){var c=this.data[i];for(cat_name in c){for(j in c[cat_name]){var d="i"+i+"j"+j,e=Object.keys(c[cat_name][j])[0];b[d]=e,c[cat_name][j].id=d,c[cat_name][j].group=cat_name,a.push(c[cat_name][j])}a.push(i)}}return[a,b]},this},PykCharts.UltimateNegative=function(a){return this.execute=function(){if(!this.validate_options())return!1;$(this.options.selection).html("<img src='/pykcharts-images/spinner.gif'> Loading... Please wait");var a=this;d3.json(this.options.data,function(b,c){a.data=c,a.render()})},this.validate_options=function(){return void 0==this.options.selection?!1:void 0==this.options.data?!1:this.options.svg_width<300?!1:!0},this.options=jQuery.extend({barchartwidthadjust:.8,barchartheightadjust:.8,box_gap:10,box_width:10,svg_width:900,svg_height:500,filterList:[],fullList:[],extended:!1,margins:{left:40,right:20,top:10,bottom:80}},a),this.render=function(){$(this.options.selection).html("");{var a=this.options.svg_height,b=this.options.svg_width,c=this.options.svg_height*this.options.barchartheightadjust,d=this.options.svg_width*this.options.barchartwidthadjust,e=(a-c)/2;this.options.box_width,this.options.box_gap}this.svg=d3.select(this.options.selection).append("svg").attr("class","pyk-ultimate").attr("height",a).attr("width",b),this.barchartg=this.svg.append("g").attr("transform","translate(0 ,"+e+")").attr("class","barchart").attr("height",c).attr("width",d),this.barchartg.append("g").attr("class","yaxis"),this.barchartg.append("g").attr("class","xaxis"),this.legends_group=this.barchartg.append("g").attr("class","legend-holder").attr("background","Red").attr("transform","translate(100,15)"),this.chart_group=this.barchartg.append("g").attr("class","chart-holder").attr("width",d-(this.options.margins.right+this.options.margins.left)).attr("height",c-(this.options.margins.top+this.options.margins.bottom)).attr("transform","translate("+this.options.margins.left+","+this.options.margins.top+")");var f=this.flattenData(this.data);this.the_bars=f[0],this.the_keys=f[1],this.the_layers=this.layers(this.the_bars),this.renderTooltip(),this.draw()},this.getParameters=function(){var a=this,b=[];for(i in a.the_layers)if(a.the_layers[i].name){var c=a.the_layers[i].name,d=a.the_layers[i].values[0].color;b.push({name:c,color:d})}return b},this.onlyFilter=function(a){var b=this.options.filterList.indexOf(a);1===this.options.filterList.length&&-1!=b?this.options.filterList=[]:(this.options.filterList=[],this.options.filterList.push(a)),this.draw()},this.toggleFilter=function(a){var b=this.options.filterList.indexOf(a);-1===b?this.options.filterList.push(a):this.options.filterList.splice(b,1),this.draw()},this.renderLegends=function(){var a=this,b=this.options.width,c=this.getParameters();this.legends_group.selectAll("g.legend_group").remove();var d=this.legends_group.selectAll("g.legend_group").data(c).enter().append("g").attr("class","legend_group").attr("transform",function(a,c){return"translate("+(b-80*c-100)+", 0)"});for(i in c){var e=d3.select(d[0][i]),f=c[i],g=e.selectAll("text").data([f]);g.enter().append("text"),g.text(function(){return f.name}).attr("x",function(a,b){return 40*b}).attr("dy",-3).on("click",function(b){a.toggleFilter(b.name)});var h=e.selectAll("circle").data([f]);h.enter().append("circle"),h.attr("cx",function(a,b){return 100*b-10}).attr("cy",-6).attr("r",6).attr("style",function(b){var c=-1===a.options.filterList.indexOf(b.name)?"#fff":b.color;return"fill: "+c+"; stroke-width: 3px; stroke:"+b.color})}},this.getGroups=function(){var a={};for(i in this.the_bars){var b=this.the_bars[i];b.id&&(a[b.group]?a[b.group].push(b.id):a[b.group]=[b.id])}return a},this.renderChart=function(){var a=this,b=this.chart_group.attr("width"),c=this.chart_group.attr("height"),d=this.the_bars,e=this.the_keys,f=this.the_layers,g=this.getGroups(),h=(d3.layout.stack().values(function(a){return a.values})(f),[]);f.map(function(a,b){for(b in a.values){var c=a.values[b];h.push(c.y+c.y0)}});var j=d3.scale.ordinal().domain(d.map(function(a,b){return a.id||b})).rangeBands([0,b-this.options.box_gap],.2),k=Math.max(Math.abs(d3.min(h)),Math.abs(d3.max(h))),l=10,m=(d3.scale.category10(),d3.scale.ordinal().domain(["J","F","M","A","M","J","J","A","S","O","N","D"]).rangeRoundBands([l,b-l],.1)),n=d3.scale.linear().range([c-l,0+l]);n.domain([-k,k]);var o=(d3.scale.linear().domain([-k,k]).range([0,c]).nice(),d3.scale.linear().domain([k,-k]).range([0,c]).nice()),p=(d3.scale.category10(),d3.svg.axis().scale(o).tickSize(-b,0,0).orient("left")),q=d3.svg.axis().scale(j).tickSize(-c,0,0).tickFormat(function(a){return e[a]?e[a]:void 0});this.barchartg.select("g.yaxis").transition(1e3).attr("transform","translate("+this.options.margins.left+", "+this.options.margins.top+")").call(p);var r=parseInt(this.options.margins.top)+parseInt(c);this.barchartg.select("g.xaxis").transition(1e3).attr("transform","translate("+this.options.margins.left+", "+r+")").call(q).selectAll("text").style("text-anchor","start").attr("dy","2px").attr("dx","20px").attr("transform",function(){return"rotate(90)"});var s=[];for(i in g){var t=g[i],m=j(t[0]),u=j.rangeBand()*t.length+a.options.box_width,m=m+u/2;s.push({x:m,name:i})}s.length>1&&this.barchartg.selectAll("text.group_label").data(s).enter().append("text").attr("class","group_label").attr("x",function(b){return b.x+a.options.margins.left}).attr("y",function(){return n(0)+20}).attr("text-anchor","middle").text(function(a){return a.name});var v=this.chart_group.selectAll("g.bars").data(this.barStack(f));v.enter().append("g").attr("class","bars");var w=v.selectAll("rect").data(function(a){return a.values});w.enter().append("g.barchart:rect").attr("height",0).attr("y",c).on("mouseover",function(b){a.tooltip.html(b.tooltip),a.tooltip.style("visibility","visible")}).attr("fill",function(a){return a.color}).on("mousemove",function(){var b=parseInt(a.tooltip.style("height"))+40,c=parseInt(a.tooltip.style("width"))/2;a.tooltip.style("top",event.pageY-b+"px").style("left",event.pageX-c+"px")}).on("mouseout",function(){a.tooltip.style("visibility","hidden")}).on("click",function(b){a.onlyFilter(b.name)}),w.transition().duration(1e3).attr("x",function(a){return j(a.x)}).attr("width",function(){return j.rangeBand()+a.options.box_width}).attr("y",function(a){return n(a.y0)}).attr("height",function(a){return Math.abs(n(0)-n(a.y))})},this.draw=function(){this.options.fullList=this.getParameters().map(function(a){return a.name}),this.options.filterList=0===this.options.filterList.length?this.options.fullList:this.options.filterList;var a=jQuery.extend(!0,[],this.data);a=this.filterData(a);var b=this.flattenData(a);this.the_bars=b[0],this.the_keys=b[1],this.the_layers=this.layers(this.the_bars),this.renderLegends(),this.renderChart()},this.filterData=function(a){var b=this.options.filterList;for(i in a){var c=a[i];for(j in c){var d=c[j];for(k in d){var e=d[k];for(l in e){var f=e[l];for(m in f){var g=f[m];-1==b.indexOf(g.name)&&(g.val=0)}break}}}}return a},this.renderTooltip=function(){$("#pyk-ultimate-tooltip").remove(),this.tooltip=d3.select("body").append("div").attr("id","pyk-ultimate-tooltip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background","#fff").style("padding","10px 20px").style("box-shadow","0 0 10px #000").style("border-radius","5px").text("a simple tooltip")},this.barStack=function(a){var b=new Array;console.log("changed input="+a.length),console.log("checking....dzz.="+JSON.stringify(a));var c=a.length;console.log("length="+c),a.forEach(function(a){console.log(">>>>>>>>>>>.="+JSON.stringify(a.values)),b.push(a.values)}),console.log("~~~~~~~~~~~="+JSON.stringify(b));var c=b[0].length;console.log("length="+c);var c=b[0].length;for(console.log("length====***="+c);c--;){var d=0,e=0;console.log("loopla"),b.forEach(function(a){console.log("starting,,posBase="+d),console.log("starting,,negBase="+e),a=a[c],a.size=Math.abs(a.y),console.log("dy="+a.y),a.y<0?(console.log("if====*** negBase="+e),a.y0=e,e-=a.size,console.log("if====*** y0="+a.y0)):(console.log("else====*** posBase="+d),a.y0=d+=a.size,console.log("else====*** y0="+a.y0))})}return a.extent=d3.extent(d3.merge(d3.merge(a.map(function(a){return console.log("eeeeee	="+JSON.stringify(a)),[a.y0,a.y0-a.size]})))),console.log("output="+JSON.stringify(a)),a},this.layers=function(a){function b(a){for(i in d){var b=d[i];if(b.name==a)return b}return c(a)}function c(a){var b={name:a,values:[]};return d.push(b),b}var d=[];for(i in a){var e=a[i];if(e.id){var f=e.id;for(k in e)if("id"!==k){var g=e[k];for(j in g){var h=g[j];if(h.name){var l=b(h.name);l.values.push({x:f,y:h.val,color:h.color,tooltip:h.tooltip,name:h.name})}}}}}return d},this.flattenData=function(a){var b=[-1],c={};for(i in a){var d=a[i];for(cat_name in d){for(j in d[cat_name]){var e="i"+i+"j"+j,f=Object.keys(d[cat_name][j])[0];c[e]=f,d[cat_name][j].id=e,d[cat_name][j].group=cat_name,b.push(d[cat_name][j])}b.push(i)}}return[b,c]},this};